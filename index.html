<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ„ åœ£è¯å¿«ä¹ - ä¸“å±ä½ çš„æƒŠå–œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root { --red: #d63031; --green: #2d3436; --gold: #f1c40f; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #001a2d; color: white; font-family: 'PingFang SC', sans-serif; overflow: hidden; }

        /* é›ªèŠ±ç”»å¸ƒ */
        #snow-canvas { position: fixed; top: 0; left: 0; z-index: 1; pointer-events: none; }

        /* ä¿¡å°åŒ…è£… */
        .envelope-wrapper {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 100; cursor: pointer; text-align: center;
        }

        .envelope {
            width: 280px; height: 180px; background: var(--red);
            border-radius: 0 0 10px 10px; position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .envelope::before {
            content: ''; position: absolute; top: -100px; left: 0;
            border-left: 140px solid transparent; border-right: 140px solid transparent;
            border-bottom: 100px solid #b71c1c; z-index: 2; transition: 0.5s;
        }

        .heart {
            position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
            font-size: 40px; color: var(--gold); z-index: 10;
        }

        /* ç¥ç¦å¡ç‰‡ */
        .card {
            position: absolute; bottom: 0; left: 10px; width: 260px; height: 160px;
            background: white; color: #333; padding: 20px; border-radius: 5px;
            transition: 0.8s; z-index: 1; opacity: 0;
        }

        /* åœ£è¯æ ‘å®¹å™¨ */
        #tree-container {
            position: fixed; bottom: 10%; left: 50%; transform: translateX(-50%);
            z-index: 2; display: none; text-align: center;
        }

        .msg {
            font-size: 24px; font-weight: bold; margin-top: 20px;
            text-shadow: 0 0 10px var(--gold); opacity: 0;
        }

        .buy-btn {
            margin-top: 20px; padding: 10px 30px; background: var(--red);
            border: none; color: white; border-radius: 20px; cursor: pointer;
        }
    </style>
</head>
<body>

<canvas id="snow-canvas"></canvas>

<div class="envelope-wrapper" id="opener" onclick="openSurprise()">
    <div class="envelope">
        <div class="heart">ğŸ</div>
        <div class="card" id="letter">
            <h4 style="color: var(--red)">To æˆ‘çš„æœ‹å‹:</h4>
            <p style="font-size: 14px; margin-top: 10px;">æ„¿ä½ çš„åœ£è¯å……æ»¡å–œæ‚¦ï¼Œ<br>å¹³å®‰å¤œé‡Œä¸‡äº‹é¡ºé‚ã€‚ğŸŒŸ</p>
        </div>
    </div>
    <p style="margin-top: 20px; color: var(--gold); letter-spacing: 2px;">ç‚¹å‡»æ‹†å¼€æƒŠå–œ</p>
</div>

<div id="tree-container">
    <div id="tree-canvas-placeholder" style="font-size: 100px;">ğŸ„</div>
    <div class="msg" id="blessing">MERRY CHRISTMAS</div>
    <div class="msg" id="sub-blessing" style="font-size: 16px; color: var(--gold);">å¹³å®‰å–œä¹ï¼Œå¾—å¿æ‰€æ„¿</div>
    <button class="buy-btn" onclick="location.reload()">å†çœ‹ä¸€é</button>
</div>

<audio id="bgm" loop>
    <source src="https://m801.music.126.net/20231224160000/christmas.mp3" type="audio/mpeg">
</audio>

<script>
    // 1. 3D é›ªèŠ±ç³»ç»Ÿ
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('snow-canvas'), alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);

    const snowGeo = new THREE.BufferGeometry();
    const snowCount = 2000;
    const posArray = new Float32Array(snowCount * 3);

    for(let i=0; i<snowCount*3; i++) {
        posArray[i] = (Math.random() - 0.5) * 20;
    }
    snowGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
    const snowMat = new THREE.PointsMaterial({ size: 0.05, color: 0xffffff, transparent: true, opacity: 0.8 });
    const snow = new THREE.Points(snowGeo, snowMat);
    scene.add(snow);
    camera.position.z = 5;

    function animateSnow() {
        requestAnimationFrame(animateSnow);
        snow.rotation.y += 0.002;
        snow.position.y -= 0.01;
        if(snow.position.y < -5) snow.position.y = 5;
        renderer.render(scene, camera);
    }
    animateSnow();

    // 2. äº¤äº’é€»è¾‘
    function openSurprise() {
        // æ’­æ”¾éŸ³ä¹
        const bgm = document.getElementById('bgm');
        bgm.play().catch(() => console.log("ç­‰å¾…äº¤äº’æ’­æ”¾"));

        // ä¿¡å°åŠ¨ç”»
        gsap.to(".envelope-wrapper", { y: -100, opacity: 0, duration: 1, ease: "power2.in", onComplete: () => {
            document.getElementById('opener').style.display = 'none';
            showTree();
        }});
    }

    function showTree() {
        const treeCont = document.getElementById('tree-container');
        treeCont.style.display = 'block';
        
        // ç¥ç¦è¯­åŠ¨ç”»
        gsap.to("#blessing", { opacity: 1, y: -20, duration: 1.5, delay: 0.5 });
        gsap.to("#sub-blessing", { opacity: 1, y: -10, duration: 1.5, delay: 1 });
        
        // åœ£è¯æ ‘ç¼©æ”¾
        gsap.from("#tree-canvas-placeholder", { scale: 0, rotation: 720, duration: 2, ease: "elastic.out(1, 0.3)" });
        
        // èƒŒæ™¯é›ªèŠ±åŠ é€Ÿ
        gsap.to(snow.rotation, { y: 0.05, duration: 5 });
    }

    // çª—å£é€‚é…
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
</script>
</body>
</html>
